<%
function isNonBlankString(s) {
  return s && (s.trim().length > 0);
}

var address = null;

try {
  var recognitionResult = recognitionResults['com.solveforall.recognition.location.UsAddress'][0];

  var address = recognitionResult.streetAddress || '';

  var city = recognitionResult.city;
  if (isNonBlankString(city)) {
    if (address.length > 0) {
      address += ', ';
    }

    address += city;
  }

  var state = recognitionResult.stateAbbreviation;
  if (isNonBlankString(state)) {
    if (address.length > 0) {
      address += ', ';
    }

    address += state;
  }

  var zipCode = recognitionResult.zipCode;
  if (isNonBlankString(zipCode)) {
    if (address.length > 0) {
      address += ' ';
    }
    address += zipCode;
  }
} catch (e) {
  console.log('Recognition result not found, falling back to query');
  address = q;
}

var settings = context.settings || {};
%>

<!DOCTYPE html>
<html>
<head>
  <title>Google Maps</title>

  <style>
       html { height: 100% }
       body { height: 100%; margin: 0px; padding: 0px }
       #map_canvas { height: 20% }
  </style>
</head>

<body>
  <section style="width:100%; height:100%" >
    <div id="map_canvas" style="width:100%; height:100%"></div>
  </section>

  <div id="data" data-address="<%= address %>"
   data-zoom="<%= (settings.zoomLevel || 15) %>"
   data-map-type="<%= (settings.mapType || 'roadmap') %>"
   data-tilt="<%= (settings.tilt || 'true') %>"
  ></div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js">
  </script>

  <script src="https://maps.google.com/maps/api/js?sensor=false"></script>

  <script src="https://googledrive.com/host/0B9oRjsJCVus3SGczand1LThickk/map.js">
  </script>
</body>
</html>
